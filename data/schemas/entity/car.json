{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/entity/car.json",
  "title": "Car Entity Schema",
  "description": "JSON schema for Car entity in the event-based processing system",
  "type": "object",
  "properties": {
    "entityHeader": {
      "$ref": "entity-header.json"
    },
    "id": {
      "type": "string",
      "description": "Unique identifier for the car"
    },
    "vin": {
      "type": "string",
      "pattern": "^[A-HJ-NPR-Z0-9]{17}$",
      "description": "Vehicle Identification Number (17-character alphanumeric)"
    },
    "make": {
      "type": "string",
      "description": "Car manufacturer"
    },
    "model": {
      "type": "string",
      "description": "Car model"
    },
    "year": {
      "type": "integer",
      "minimum": 1900,
      "maximum": 2030,
      "description": "Model year of the car"
    },
    "color": {
      "type": "string",
      "description": "Color of the car"
    },
    "mileage": {
      "type": "integer",
      "minimum": 0,
      "maximum": 999999,
      "description": "Current mileage of the car"
    },
    "lastServiceDate": {
      "type": "string",
      "format": "date-time",
      "description": "Date of the last service performed"
    },
    "totalBalance": {
      "type": "number",
      "minimum": 0,
      "multipleOf": 0.01,
      "description": "Total outstanding balance across all loans"
    },
    "lastLoanPaymentDate": {
      "type": "string",
      "format": "date-time",
      "description": "Date of the last loan payment"
    },
    "owner": {
      "oneOf": [
        {
          "type": "string",
          "description": "Name of the car owner (simple string format)"
        },
        {
          "type": "object",
          "description": "Owner information object",
          "properties": {
            "id": { "type": "string" },
            "firstName": { "type": "string" },
            "lastName": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "address": {
              "type": "object",
              "properties": {
                "street": { "type": "string" },
                "city": { "type": "string" },
                "state": { "type": "string" },
                "zipCode": { "type": "string" },
                "country": { "type": "string" }
              }
            },
            "description": { "type": "string" }
          }
        }
      ],
      "description": "Name of the car owner (string) or owner information object"
    },
    "description": {
      "type": "string",
      "description": "Description of the car, its condition, features, and history"
    },
    "insurance": {
      "type": "object",
      "description": "Insurance information",
      "properties": {
        "provider": { "type": "string" },
        "policyNumber": { "type": "string" },
        "expiryDate": { "type": "string", "format": "date-time" },
        "coverageType": { "type": "string" },
        "premiumAmount": { "type": "number" },
        "deductible": { "type": "number" },
        "description": { "type": "string" }
      }
    },
    "maintenance": {
      "type": "object",
      "description": "Maintenance information",
      "properties": {
        "lastServiceDate": { "type": "string", "format": "date-time" },
        "nextServiceDue": { "type": "string", "format": "date-time" },
        "mileage": { "type": "integer" },
        "oilChangeInterval": { "type": "integer" },
        "tireRotationInterval": { "type": "integer" },
        "warrantyCoverage": { "type": "string" },
        "warrantyExpiryDate": { "type": "string", "format": "date-time" },
        "description": { "type": "string" }
      }
    },
    "features": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Array of car features"
    },
    "serviceHistory": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "serviceId": { "type": "string" },
          "serviceDate": { "type": "string", "format": "date-time" },
          "serviceType": { "type": "string" },
          "mileage": { "type": "integer" },
          "cost": { "type": "number" },
          "description": { "type": "string" },
          "technician": { "type": "string" }
        }
      },
      "description": "Array of service history records"
    },
    "serviceRecords": {
      "type": "array",
      "items": {
        "$ref": "service-record.json"
      },
      "description": "Array of service records for this car"
    },
    "loans": {
      "type": "array",
      "items": {
        "$ref": "loan.json"
      },
      "description": "Array of loans associated with this car"
    }
  },
  "required": ["entityHeader", "id", "vin", "make", "model", "year", "color", "mileage", "lastServiceDate", "totalBalance", "lastLoanPaymentDate", "owner"],
  "additionalProperties": true
}
