# Filter and Routing Configuration
# This file defines filtering rules for routing events to consumer-specific topics
# Changes to this file should be version-controlled and deployed via CI/CD

filters:
  # Loan Created events filter - specifically targets LoanCreated events with car entities
  # Based on data/schemas/event/samples/loan-created-event.json structure
  - id: loan-created-filter
    name: "Loan Created Events Filter"
    description: "Filters LoanCreated events where loans reference car entities. Based on loan-created-event.json example structure."
    consumerId: loan-consumer
    outputTopic: filtered-loan-events
    conditions:
      - field: eventHeader.eventType
        operator: equals
        value: "LoanCreated"
      - field: eventHeader.eventName
        operator: equals
        value: "Loan Created"
      - field: eventBody.entities[0].entityType
        operator: equals
        value: "Loan"
    enabled: true

  # Loan Payment events filter (kept separate for LoanPaymentSubmitted events)
  - id: loan-payment-filter
    name: "Loan Payment Events Filter"
    description: "Filters LoanPaymentSubmitted events"
    consumerId: loan-consumer
    outputTopic: filtered-loan-payment-events
    conditions:
      - field: eventHeader.eventType
        operator: equals
        value: "LoanPaymentSubmitted"
      - field: eventBody.entities[0].entityType
        operator: equals
        value: "LoanPayment"
    enabled: true

  # Service-related events filter
  - id: service-events-filter
    name: "Service Events Filter"
    description: "Filters events related to car services (CarServiceDone)"
    consumerId: service-consumer
    outputTopic: filtered-service-events
    conditions:
      - field: eventHeader.eventName
        operator: equals
        value: "CarServiceDone"
      - field: eventBody.entities[0].entityType
        operator: equals
        value: "ServiceRecord"
    enabled: true

  # High-value loan filter (example of amount-based filtering)
  - id: high-value-loan-filter
    name: "High Value Loan Filter"
    description: "Filters loans with amount greater than 50000"
    consumerId: loan-consumer
    outputTopic: filtered-high-value-loans
    conditions:
      - field: eventHeader.eventName
        operator: equals
        value: "LoanCreated"
      - field: eventBody.entities[0].updatedAttributes.loan.loanAmount
        operator: greaterThan
        value: 50000
    enabled: false  # Disabled by default, enable as needed

  # Car creation events filter - based on data/entities/car/car-large.json structure
  - id: car-creation-filter
    name: "Car Creation Filter"
    description: "Filters car creation events. Based on car-large.json example structure."
    consumerId: car-consumer
    outputTopic: filtered-car-events
    conditions:
      - field: eventHeader.eventType
        operator: equals
        value: "CarCreated"
      - field: eventHeader.eventName
        operator: equals
        value: "Car Created"
      - field: eventBody.entities[0].entityType
        operator: equals
        value: "Car"
    enabled: true






