version: '3.8'

services:
  stream-processor-spring:
    build:
      context: ../stream-processor-spring
      dockerfile: Dockerfile
    container_name: e2e-stream-processor-spring
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${CONFLUENT_BOOTSTRAP_SERVERS}
      KAFKA_API_KEY: ${CONFLUENT_API_KEY}
      KAFKA_API_SECRET: ${CONFLUENT_API_SECRET}
      KAFKA_SECURITY_PROTOCOL: ${KAFKA_SECURITY_PROTOCOL:-SASL_SSL}
      KAFKA_SASL_MECHANISM: ${KAFKA_SASL_MECHANISM:-PLAIN}
      SPRING_KAFKA_STREAMS_SOURCE_TOPIC: ${SPRING_KAFKA_STREAMS_SOURCE_TOPIC:-raw-event-headers}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 10s
      timeout: 3s
      start_period: 40s
      retries: 5
    restart: unless-stopped
