version: '3.8'

services:
  # Loan Consumer (MSK)
  loan-consumer:
    build:
      context: ./consumers-msk/loan-consumer
      dockerfile: Dockerfile
    container_name: cdc-loan-consumer-msk
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      KAFKA_TOPIC: ${KAFKA_TOPIC_LOAN:-filtered-loan-created-events-msk}
      AWS_REGION: ${AWS_REGION:-us-east-1}
      CONSUMER_GROUP_ID: ${CONSUMER_GROUP_ID_LOAN:-loan-consumer-group-msk}
      KAFKA_CLIENT_ID: ${KAFKA_CLIENT_ID_LOAN:-loan-consumer-client-msk}
    networks:
      - cdc-network
    restart: unless-stopped
    # AWS credentials are provided via IAM role (ECS/EKS) or environment variables
    # For local testing, set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY

  # Loan Payment Consumer (MSK)
  loan-payment-consumer:
    build:
      context: ./consumers-msk/loan-payment-consumer
      dockerfile: Dockerfile
    container_name: cdc-loan-payment-consumer-msk
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      KAFKA_TOPIC: ${KAFKA_TOPIC_LOAN_PAYMENT:-filtered-loan-payment-submitted-events-msk}
      AWS_REGION: ${AWS_REGION:-us-east-1}
      CONSUMER_GROUP_ID: ${CONSUMER_GROUP_ID_LOAN_PAYMENT:-loan-payment-consumer-group-msk}
      KAFKA_CLIENT_ID: ${KAFKA_CLIENT_ID_LOAN_PAYMENT:-loan-payment-consumer-client-msk}
    networks:
      - cdc-network
    restart: unless-stopped

  # Car Consumer (MSK)
  car-consumer:
    build:
      context: ./consumers-msk/car-consumer
      dockerfile: Dockerfile
    container_name: cdc-car-consumer-msk
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      KAFKA_TOPIC: ${KAFKA_TOPIC_CAR:-filtered-car-created-events-msk}
      AWS_REGION: ${AWS_REGION:-us-east-1}
      CONSUMER_GROUP_ID: ${CONSUMER_GROUP_ID_CAR:-car-consumer-group-msk}
      KAFKA_CLIENT_ID: ${KAFKA_CLIENT_ID_CAR:-car-consumer-client-msk}
    networks:
      - cdc-network
    restart: unless-stopped

  # Service Consumer (MSK)
  service-consumer:
    build:
      context: ./consumers-msk/service-consumer
      dockerfile: Dockerfile
    container_name: cdc-service-consumer-msk
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      KAFKA_TOPIC: ${KAFKA_TOPIC_SERVICE:-filtered-service-events-msk}
      AWS_REGION: ${AWS_REGION:-us-east-1}
      CONSUMER_GROUP_ID: ${CONSUMER_GROUP_ID_SERVICE:-service-consumer-group-msk}
      KAFKA_CLIENT_ID: ${KAFKA_CLIENT_ID_SERVICE:-service-consumer-client-msk}
    networks:
      - cdc-network
    restart: unless-stopped

networks:
  cdc-network:
    driver: bridge

